name: GitHub Actions Workflow
run-name: ${{ github.actor }} workflow with shared Azure login
on: [push]

jobs:
  DatainjectionJob:
    runs-on: ubuntu-latest
    steps:
      # Checkout the repository
      - name: Clone repository code
        uses: actions/checkout@v4

      # Azure login (common step)
      - name: Log in to Azure
        uses: azure/login@v1
        with:
          creds: '${{ secrets.AZURE_CREDENTIALS }}'

      # Seting up Azure ML CLI extension (common for Azure ML tasks)
      - name: Install Azure ML extension
        run: |
          az extension add -n ml -y
          az extension update -n ml

 	# Stage 2: Data Cleaning
      - name: Clean dataset using Azure ML pipeline
        run: |
          az ml component create --name clean_data_component \
            --file components/clean_data.yaml \
            --workspace-name myminiproject \
            --resource-group Miniproject

          az ml job create --file jobs/clean_data_job.yaml \
            --workspace-name myminiproject \
            --resource-group Miniproject
